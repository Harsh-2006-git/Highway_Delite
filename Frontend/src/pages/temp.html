<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create Campaign</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
      }

      .header p {
        opacity: 0.9;
        font-size: 1.1rem;
      }

      .form-container {
        padding: 40px;
      }

      .form-group {
        margin-bottom: 25px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #333;
        font-size: 1rem;
      }

      .required::after {
        content: " *";
        color: #e74c3c;
      }

      input,
      select,
      textarea {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e1e5e9;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: #f8f9fa;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: #667eea;
        background: white;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      textarea {
        resize: vertical;
        min-height: 100px;
      }

      .file-upload {
        border: 2px dashed #bdc3c7;
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        background: #f8f9fa;
        transition: all 0.3s ease;
      }

      .file-upload:hover {
        border-color: #667eea;
        background: #f0f2ff;
      }

      .file-upload input {
        display: none;
      }

      .file-upload label {
        cursor: pointer;
        color: #667eea;
        font-weight: 600;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }

      .file-upload i {
        font-size: 2rem;
      }

      .file-list {
        margin-top: 15px;
        text-align: left;
      }

      .file-item {
        background: white;
        padding: 10px 15px;
        border-radius: 6px;
        margin-bottom: 8px;
        border: 1px solid #e1e5e9;
        display: flex;
        justify-content: between;
        align-items: center;
      }

      .file-item span {
        flex: 1;
      }

      .remove-file {
        background: #e74c3c;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 4px 8px;
        cursor: pointer;
        font-size: 0.8rem;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }

      .token-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 25px;
        border-left: 4px solid #667eea;
      }

      .token-section h3 {
        margin-bottom: 15px;
        color: #333;
      }

      .submit-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 8px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        width: 100%;
        transition: all 0.3s ease;
      }

      .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
      }

      .submit-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .message {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        text-align: center;
        font-weight: 600;
      }

      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .loading {
        display: none;
        text-align: center;
        margin: 20px 0;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      @media (max-width: 768px) {
        .form-row {
          grid-template-columns: 1fr;
        }

        .form-container {
          padding: 20px;
        }

        .header h1 {
          font-size: 2rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Create New Campaign</h1>
        <p>Launch your fundraising campaign and make an impact</p>
      </div>

      <div class="form-container">
        <!-- Token Section -->
        <div class="token-section">
          <h3>Authentication</h3>
          <div class="form-group">
            <label for="token" class="required">JWT Token</label>
            <input
              type="text"
              id="token"
              placeholder="Enter your JWT token here..."
              required
            />
            <small style="color: #666; margin-top: 5px; display: block">
              Make sure your token has the required permissions to create
              campaigns
            </small>
          </div>
        </div>

        <!-- Messages -->
        <div id="message" class="message" style="display: none"></div>

        <!-- Loading Spinner -->
        <div id="loading" class="loading">
          <div class="spinner"></div>
          <p style="margin-top: 10px">Creating your campaign...</p>
        </div>

        <!-- Campaign Form -->
        <form id="campaignForm">
          <div class="form-group">
            <label for="campaignTitle" class="required">Campaign Title</label>
            <input
              type="text"
              id="campaignTitle"
              placeholder="Enter a compelling title for your campaign"
              required
            />
          </div>

          <div class="form-group">
            <label for="categories" class="required">Category</label>
            <select id="categories" required>
              <option value="">Select a category</option>
              <option value="startup">Startup</option>
              <option value="research">Research</option>
              <option value="innovation">Innovation</option>
              <option value="infrastructure">Infrastructure</option>
              <option value="scholarship">Scholarship</option>
              <option value="community">Community</option>
              <option value="other">Other</option>
            </select>
          </div>

          <div class="form-group">
            <label for="tagline">Tagline</label>
            <input
              type="text"
              id="tagline"
              placeholder="Short catchy phrase about your campaign"
            />
          </div>

          <div class="form-group">
            <label for="detailedDescription">Detailed Description</label>
            <textarea
              id="detailedDescription"
              placeholder="Describe your campaign in detail..."
            ></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="startDate" class="required">Start Date</label>
              <input type="datetime-local" id="startDate" required />
            </div>

            <div class="form-group">
              <label for="endDate" class="required">End Date</label>
              <input type="datetime-local" id="endDate" required />
            </div>
          </div>

          <div class="form-group">
            <label for="totalAmount" class="required">Total Amount (‚Çπ)</label>
            <input
              type="number"
              id="totalAmount"
              placeholder="Enter target amount"
              step="0.01"
              min="0"
              required
            />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="projectLink">Project Link</label>
              <input
                type="url"
                id="projectLink"
                placeholder="https://your-project.com"
              />
            </div>

            <div class="form-group">
              <label for="github">GitHub Repository</label>
              <input
                type="url"
                id="github"
                placeholder="https://github.com/your-repo"
              />
            </div>
          </div>

          <div class="form-group">
            <label for="contact" class="required">Contact Number</label>
            <input
              type="tel"
              id="contact"
              placeholder="+91 9876543210"
              required
            />
          </div>

          <div class="form-group">
            <label>Campaign Images (Max 3 images)</label>
            <div class="file-upload">
              <input
                type="file"
                id="images"
                accept=".jpg,.jpeg,.png"
                multiple
              />
              <label for="images">
                <i>üìÅ</i>
                <span>Click to upload images or drag and drop</span>
                <small>PNG, JPG, JPEG files only (Max 5MB each)</small>
              </label>
            </div>
            <div id="fileList" class="file-list"></div>
          </div>

          <button type="submit" class="submit-btn" id="submitBtn">
            Create Campaign
          </button>
        </form>
      </div>
    </div>

    <script>
      // File handling
      const imagesInput = document.getElementById("images");
      const fileList = document.getElementById("fileList");
      const selectedFiles = [];

      imagesInput.addEventListener("change", function (e) {
        const files = Array.from(e.target.files);

        // Check file count
        if (files.length > 3) {
          showMessage(
            "Maximum 3 images allowed. Please select again.",
            "error"
          );
          this.value = "";
          return;
        }

        // Validate file types and sizes
        const validFiles = files.filter((file) => {
          const isValidType = ["image/jpeg", "image/jpg", "image/png"].includes(
            file.type
          );
          const isValidSize = file.size <= 5 * 1024 * 1024; // 5MB

          if (!isValidType) {
            showMessage(
              `Invalid file type: ${file.name}. Only JPG, JPEG, PNG allowed.`,
              "error"
            );
          }
          if (!isValidSize) {
            showMessage(
              `File too large: ${file.name}. Max 5MB allowed.`,
              "error"
            );
          }

          return isValidType && isValidSize;
        });

        // Update selected files
        selectedFiles.length = 0;
        selectedFiles.push(...validFiles);

        updateFileList();
      });

      function updateFileList() {
        fileList.innerHTML = "";
        selectedFiles.forEach((file, index) => {
          const fileItem = document.createElement("div");
          fileItem.className = "file-item";
          fileItem.innerHTML = `
                    <span>${file.name} (${(file.size / 1024 / 1024).toFixed(
            2
          )} MB)</span>
                    <button type="button" class="remove-file" onclick="removeFile(${index})">Remove</button>
                `;
          fileList.appendChild(fileItem);
        });
      }

      function removeFile(index) {
        selectedFiles.splice(index, 1);
        updateFileList();

        // Update the file input
        const dataTransfer = new DataTransfer();
        selectedFiles.forEach((file) => dataTransfer.items.add(file));
        imagesInput.files = dataTransfer.files;
      }

      // Drag and drop functionality
      const fileUpload = document.querySelector(".file-upload");

      fileUpload.addEventListener("dragover", function (e) {
        e.preventDefault();
        this.style.borderColor = "#667eea";
        this.style.background = "#f0f2ff";
      });

      fileUpload.addEventListener("dragleave", function (e) {
        e.preventDefault();
        this.style.borderColor = "#bdc3c7";
        this.style.background = "#f8f9fa";
      });

      fileUpload.addEventListener("drop", function (e) {
        e.preventDefault();
        this.style.borderColor = "#bdc3c7";
        this.style.background = "#f8f9fa";

        const files = Array.from(e.dataTransfer.files);
        if (files.length > 0) {
          imagesInput.files = e.dataTransfer.files;
          imagesInput.dispatchEvent(new Event("change"));
        }
      });

      // Form submission
      document
        .getElementById("campaignForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const token = document.getElementById("token").value.trim();
          if (!token) {
            showMessage("Please enter your JWT token", "error");
            return;
          }

          // Validate required fields
          const requiredFields = [
            "campaignTitle",
            "categories",
            "startDate",
            "endDate",
            "totalAmount",
            "contact",
          ];
          const missingFields = requiredFields.filter(
            (field) => !document.getElementById(field).value.trim()
          );

          if (missingFields.length > 0) {
            showMessage("Please fill all required fields", "error");
            return;
          }

          // Validate dates
          const startDate = new Date(
            document.getElementById("startDate").value
          );
          const endDate = new Date(document.getElementById("endDate").value);
          const now = new Date();

          if (startDate < now) {
            showMessage("Start date cannot be in the past", "error");
            return;
          }

          if (endDate <= startDate) {
            showMessage("End date must be after start date", "error");
            return;
          }

          // Show loading
          showLoading(true);
          hideMessage();

          try {
            const formData = new FormData();

            // Add form fields
            formData.append(
              "campaignTitle",
              document.getElementById("campaignTitle").value
            );
            formData.append(
              "categories",
              document.getElementById("categories").value
            );
            formData.append(
              "tagline",
              document.getElementById("tagline").value
            );
            formData.append(
              "detailedDescription",
              document.getElementById("detailedDescription").value
            );
            formData.append(
              "startDate",
              document.getElementById("startDate").value
            );
            formData.append(
              "endDate",
              document.getElementById("endDate").value
            );
            formData.append(
              "totalAmount",
              document.getElementById("totalAmount").value
            );
            formData.append(
              "projectLink",
              document.getElementById("projectLink").value
            );
            formData.append("github", document.getElementById("github").value);
            formData.append(
              "contact",
              document.getElementById("contact").value
            );

            // Add images
            selectedFiles.forEach((file) => {
              formData.append("images", file);
            });

            const response = await fetch(
              "http://localhost:3001/campaign/create-campaign",
              {
                method: "POST",
                headers: {
                  Authorization: `Bearer ${token}`,
                },
                body: formData,
              }
            );

            const data = await response.json();

            if (response.ok) {
              showMessage("Campaign created successfully!", "success");
              resetForm();
            } else {
              showMessage(data.message || "Error creating campaign", "error");
            }
          } catch (error) {
            showMessage("Network error: " + error.message, "error");
          } finally {
            showLoading(false);
          }
        });

      // Utility functions
      function showMessage(message, type) {
        const messageDiv = document.getElementById("message");
        messageDiv.textContent = message;
        messageDiv.className = `message ${type}`;
        messageDiv.style.display = "block";

        // Auto-hide success messages after 5 seconds
        if (type === "success") {
          setTimeout(() => {
            messageDiv.style.display = "none";
          }, 5000);
        }
      }

      function hideMessage() {
        document.getElementById("message").style.display = "none";
      }

      function showLoading(show) {
        document.getElementById("loading").style.display = show
          ? "block"
          : "none";
        document.getElementById("submitBtn").disabled = show;
      }

      function resetForm() {
        document.getElementById("campaignForm").reset();
        selectedFiles.length = 0;
        updateFileList();

        // Reset file input
        imagesInput.value = "";
      }

      // Set minimum datetime for date inputs to current time
      const now = new Date();
      const timezoneOffset = now.getTimezoneOffset() * 60000;
      const localISOTime = new Date(now - timezoneOffset)
        .toISOString()
        .slice(0, 16);

      document.getElementById("startDate").min = localISOTime;
      document.getElementById("endDate").min = localISOTime;

      // Update end date min when start date changes
      document
        .getElementById("startDate")
        .addEventListener("change", function () {
          document.getElementById("endDate").min = this.value;
        });
    </script>
  </body>
</html>
